(()=>{"use strict";var e={231:e=>{e.exports=require("fs")},423:e=>{e.exports=require("path")},608:(e,t,o)=>{o.d(t,{nb2json:()=>a});const n=require("marked");function r(e,t){return"<details "+(t?"open":"")+"> <summary>Click to toggle</summary> "+e+"</details>"}function i(e,t,o){return e.replace(t,(function(e,t){return o.replace?.("$1",t)||o(e,t)}))}let l=!1,s=[];async function a(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s=[],l=!1;let o=e;"undefined"==typeof process||e.startsWith("http")||(o=`http://localhost:8085/${e}.ipynb`);let a=await fetch(o,{headers:{"Content-Type":"application/json; charset=utf-8"}});const p=await a.json(),d=function(e){const t={};for(const o of e.source)if(o.startsWith("#"))t.title=o.replaceAll("\n","").replaceAll("# ","",2);else if(o.startsWith(">"))t.summary=o.replaceAll("\n","").replaceAll("> ","",1);else if(o.startsWith("-")){const e=o.slice(o.indexOf("- ")+2,o.indexOf(": ")),n=o.slice(o.indexOf(": ")+2).replaceAll("\n","").trim();t[e]=n}return t}(p.cells[0]);d.filename=e.split("/")[e.split("/").length-1].toLowerCase().replaceAll(" ","_"),t&&console.log("- get_metadata",d,"\n");let u=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&console.log("- convertNb Running"),e.map((e=>function(e,t){let o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a&&console.log("- - cleanCell Running"),"markdown"==e.cell_type?(a&&console.log("- - - Parsing Markdown"),o=function(e){return e=e.replace(/\(\(\((.*?)::(.*?)\)\)\)/g,(function(e,t,o){return"note"==t?e:`<aside class="${t}">${o}</aside>`})),e=i(e=(e=n.marked.parse(e)).replace(/<li>(.*?)<\/li>/g,((e,t)=>`<li>${/<(p|div|blockquote|pre|hr|form)/.test(t)?`<div>${t}</div>`:`<p>${t}</p>`}</li>`)),/<pre><code>([\s\S]*?)<\/code><\/pre>/g,(()=>{l=!0})),e=i(e,/<code>([\s\S]*?)<\/code>/g,(()=>{l=!0})),e=function(e){let t=0;return e.replace(/(<p)(.*?)\(\(\((.*?)::(.*?)\)\)\)(.*?)(<\/p>)/g,((e,o,n,r,i,l,s)=>{t++;let a=`<label  tabindex="0" for='note${t}' class='notelbl'>[${t}]</label>`;return`<div>\n      <input type='checkbox' id='note${t}' class='notebox'>\n      ${o}${n}${a}${l}${s}\n      <aside>${a} ${i} </aside> \n    </div>`}))}(e=i(e,/<a\s+(?:[^>]*?\s+)?href="(.*?)"/g,((e,t)=>(t.startsWith("./")||(e+=' onclick="window.pingServer(this)" target="_blank" rel="noopener noreferrer nofollow"'),e))))}(e.source.join(" "))):o=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o&&console.log("- - - processCode Running");let n=[],i=[];if(e.source.length){o&&console.log("- - - - Raw Input Source",e.source);let l=e.source;i=function(e){const t=e.split(/\s+/);return["#collapse_input_open","#collapse_input","#collapse_output_open","#collapse_output","#hide_input","#hide_output","#hide","%%capture","%%javascript","%%html","#export"].filter((e=>t.includes(e)))}(l[0]),o&&console.log("- - - - - Flags: ",i),i.length>0&&(l=l.slice(1)),l=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"#export"==t[t.length-1]&&s.push(e);for(let e of t)if(["#hide","#hide_input","%%javascript","%%html","%%capture"].includes(e))return"";if(o.prettify&&(e=`<pre class='prettyprint'>${e}</pre>`),t&&!!t.includes("#collapse_input_open")){n&&console.log(t);for(let o of t)e=(e=e.replaceAll(o+"\r\n","")).replaceAll(o+"\n",""),"#collapse_input_open"==o?e=r(e,!0):"#collapse_input"==o&&(e=r(e,!1));return e}}(l.join(" "),i,t),n.push(l)}if(e.outputs.length){o&&console.log("- - - - Raw Process Outputs",e.outputs);for(let t of e.outputs)n.push(c(t,i));o&&console.log("- - - - - processOutput: ",n)}return o&&console.log("- - - processCode Ran"),n}(e,t),o}(e,t)))}(p.cells.slice(1),d).flat().join(" ");t&&s.length&&console.log({pyCode:s}),d.pyCode=s,(d.prettify||l)&&(u+='\n  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"><\/script>\n  <link rel="stylesheet" href="https://cdn.rawgit.com/google/code-prettify/master/styles/desert.css"/>\n  '),t&&console.log("- - content Ran ~~~~~~~~~~~",u,"~~~~~~~~~~~\n");let g=u.replaceAll("ðŸ™‚","&#1F642").replaceAll("ðŸ˜³","&#128563").replaceAll("â€ƒ","&#8195").replaceAll("ðŸ‘·","&#128119").replaceAll("ðŸ§¡","&#129505").replaceAll("ðŸ’–","&#128150");return t&&console.log("- - replaceEmojis Ran","\n"),{meta:d,content:g}}function c(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("error"==e.output_type)return"";if("stream"==e.output_type){if("stderr"==e.name)return"";e.data={"text/html":e.text}}const n=Object.keys(e.data);n.includes("text/html")?e=(e=e.data["text/html"]).join(""):n.includes("application/javascript")?e="<script>"+e.data["application/javascript"]+"<\/script>":n.includes("image/png")?e='<img src="data:image/png;base64,'+e.data["image/png"]+"\" alt='Image Alt Text'>":n.includes("text/plain")&&(e=/<Figure/.test(e.data["text/plain"])?"":e.data["text/plain"]);for(let n of t){try{e=(e=e.replaceAll(n+"\r\n","")).replaceAll(n+"\n","")}catch{o&&console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!processOutput... ",typeof e,e)}"#collapse_output_open"==n&&(e=r(e,!0)),"#collapse_output"==n&&(e=r(e,!1)),"#hide_output"==n&&(e=""),"#hide"==n&&(e="")}return e}},272:(e,t,o)=>{o.d(t,{speechFromDir:()=>a});var n=o(231),r=o(423);async function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"echo",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"tts-1",i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(t||(t=process.env.OPENAI_API_KEY),t){try{new OpenAI(t);const i=await fetch("https://api.openai.com/v1/audio/speech",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,input:e,voice:o,speed:n,response_format:"mp3"})});var l=await i.buffer()}catch(e){return void(i&&console.log("createSpeech error",e))}return l}i&&console.log('No API Key provided and "env.OPENAI_API_KEY" not found.')}async function l(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{await n.promises.writeFile(e,t),o&&console.log(`Audio saved to ${e}`)}catch(e){o&&console.log("saveSpeech error",e)}}async function s(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t||(t=process.env.OPENAI_API_KEY),t){try{let o=e.title?`Title:   ${e.title} \n `:"";o+=e.summary?`Summary: ${e.summary} \n `:"",o+=`Content: ${JSON.stringify(e.content)}`;const n={model:"gpt-4-1106-preview",messages:[{role:"system",content:'\nYou are an assistant to a webpage to audio service. \nYou will be given a webpage you must convert it to a form of text ready for reading aloud.\nStart every conversion with a statement "You are listening to the audio version of this webpage" followed by the title and summary.\nUnder no circumstances should code be read and should be paraphrased or skipped. \n'},{role:"user",content:o}]},r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});let i;i=(await r.json()).choices[0].message.content}catch(e){return void(o&&console.log("getTextFromJson error",e))}return data}o&&console.log('No API Key provided and "env.OPENAI_API_KEY" not found.')}async function a(e,t,o){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o||(o=process.env.OPENAI_API_KEY),o)try{const c=n.readdirSync(e);for(let p=0;p<c.length;p++){const d=r.join(e,c[p]);if(n.lstatSync(d).isDirectory())a(d,t);else if(d.indexOf(".json")>=0){let e=n.readFileSync(d,"utf8"),a=JSON.parse(e);if(a?.meta?.audio){let e=await s(a),n=await i(e,o),d=c[p].substring(0,c[p].length-5);l(r.join(t,d)+".mp3",n)}}}}catch(e){return void(c&&console.log("speechFromDir error",e))}else c&&console.log('No API Key provided and "env.OPENAI_API_KEY" not found.')}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{o.r(n),o.d(n,{default:()=>p});var e=o(231),t=o(423);const i=require("http-server");async function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./src/client/posts/",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"./sitemap.txt",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];n&&console.log("\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ START createSitemap \n\n"),await s(r,t,"");try{await e.writeFile(o,r.join("\n")+"\n"),n&&console.log("Sitemap file created successfully:",o)}catch(e){n&&console.error(`Error creating or truncating sitemap file: ${o}`,e)}}async function s(o,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(await e.stat(n)).isDirectory())return void(i&&console.log("\n\n UNABLE TO PROCESS DIRECTORY: ",n,r));const l=await e.readdir(n);await Promise.all(l.filter((e=>e.includes("_map.json"))).map((async i=>{const l=t.join(n,i);JSON.parse(await e.readFile(l,"utf-8")).forEach((e=>{e.filename&&o.push(`http://www.charleskarpati.com/${i.split("_")[0].split(".")[0]}/${r?r+"/":""}${e.filename}`)}))}))),await Promise.all(l.filter((e=>!t.extname(e))).map((e=>s(o,t.join(n,e),t.join(r,e)))))}async function a(n,r){let i,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"json";if("json"===l){const{nb2json:e}=await Promise.resolve().then(o.bind(o,608));i=await e(n)}let s=i.meta.pyCode;if(s?.length){let o=t.basename(n,".ipynb");o=o.replace(/^\d{2}_/,""),o=i.meta.default_exp||o;let l=t.join(r,`${o}.py`),a=s.join("\n").replace(/(^|\n) /g,"$1");await e.writeFile(l,a)}delete i.meta.pyCode;const a=t.join(r,`${i.meta.filename}.${l}`);try{await e.writeFile(a,"json"===l?JSON.stringify(i):i)}catch(e){console.log("ERROR writing file:",a)}return i}function c(n){const s=n[0]||"",c=n[1]||!1,p=n[2]||!1,d=n[2]||!1;console.log("CLI RECIEVED: ",{args:n,directory:s}),"sitemap"===s?l(c,d):"audio"===s?async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./src/client/posts/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"./src/client/audio/";const{speechFromDir:n}=await Promise.resolve().then(o.bind(o,272));n(e,t)}(p,c):async function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./src/ipynb/",n=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"./src/client/posts/",s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s&&console.log(`\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ cli_nbs2html: start: ${o}${n}/`),(await e.stat(`${o}${n}/`)).isDirectory()?async function(t,o,n,l){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];s&&console.log("\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ cli_nbs2html: generate_sectionmap: ",t,n,s=!1);const c=i.createServer({root:"./",cors:!0,host:"0.0.0.0"});c.listen(8085,(()=>{}));let p=[];try{await e.access(`${l}${n}`)}catch(t){if("ENOENT"===t.code)try{await e.mkdir(`${l}${n}`,{recursive:!0})}catch(e){console.error("Error creating directory:",e)}else console.error("Error accessing directory:",t)}if(n){let{csp:e,sitemap:t,breadcrumbs:r,badges:i,keywords:s,comments:c,hide:d,image:u,toc:g,title:f,...h}=(await a(`${o}${n}`,l)).meta;p.push(h)}for(const e of t){const t=!e.startsWith("_")&&await a(`${o}${n}/${e}`,`${l}${n}`);if(t&&!t.meta.hide){const{csp:e,sitemap:o,breadcrumbs:n,badges:r,keywords:i,comments:l,hide:s,image:a,toc:c,title:d,...u}=t.meta;p.push(u)}}const d=`${l}${n||"index"}_map.json`;try{await e.writeFile(d,JSON.stringify(p))}catch(t){await e.writeFile(d,"{}"),s&&console.log("----ERROR:",r.meta)}c.close((()=>{s&&console.log("Server closed.")}))}((await e.readdir(`${o}${n}/`)).filter((e=>".ipynb"===t.extname(e))).map((e=>t.parse(e).name)),o,n,l):s&&console.log("\n\n UNABLE TO PROCESS DIRECTORY: ",n,subdir)}(p,s,c)}require.main===module&&c(process.argv.slice(2));const p=c})(),module.exports=n})();